(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const t={targetGestureLabel:"Waiting...",currentWeights:[0,0,0,0,0],targetWeights:[0,0,0,0,0],spreadTarget:1,currentSpread:1,scatterScaleTarget:1,currentScatterScale:1,fingerCount:0,galaxyEffectActive:!1,voiceModeActive:!1,wasVoiceModeActive:!1,voiceEnabledByUser:!1,handPositionRaw:{x:.5,y:.5},handPositions:[],isHandDetected:!1,musicActivated:!1,heartGestureStart:0,isViewLocked:!1},p={particleCount:4e4,text1:"I",text2:"MISS YOU",text3:"‚ù§Ô∏è",text4:"I MISS YOU",particleSize:.08,scatterRadius:35,textScale:.055,camZ:40,interactionRadius:8,repulsionStrength:8},xe=document.getElementById("canvas-container"),b=new THREE.Scene;b.background=new THREE.Color(328965);b.fog=new THREE.FogExp2(328965,.012);const E=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);E.position.z=p.camZ;const $e=THREE.MathUtils.degToRad(E.fov),Te=2*Math.tan($e/2)*E.position.z,Me=Te*E.aspect,I=new THREE.WebGLRenderer({antialias:!0,alpha:!0});I.setSize(window.innerWidth,window.innerHeight);I.setPixelRatio(window.devicePixelRatio);xe&&xe.appendChild(I.domElement);const D=new THREE.OrbitControls(E,I.domElement);D.enableDamping=!0;D.dampingFactor=.05;D.autoRotate=!1;D.enableZoom=!1;window.addEventListener("resize",()=>{E.aspect=window.innerWidth/window.innerHeight,E.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)});function C(e,i=2,s=null){console.log(`Generating text coords for: "${e}"`);const o=document.createElement("canvas"),n=o.getContext("2d"),r=3e3,a=800;o.width=r,o.height=a,n.fillStyle="black",n.fillRect(0,0,r,a),n.fillStyle="white",n.font="900 250px Arial, sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillText(e,r/2,a/2);const m=n.getImageData(0,0,r,a).data,c=[],d=s||p.textScale;for(let g=0;g<a;g+=i)for(let f=0;f<r;f+=i){const T=(g*r+f)*4;if(m[T]>128){const M=(f-r/2)*d,h=-(g-a/2)*d;c.push(new THREE.Vector3(M,h,0))}}return console.log(`Generated ${c.length} points for "${e}"`),c}const qe=C(p.text1,3),_e=C(p.text2,3),je=C(p.text3,3),Ne=C(p.text4,3);let Ze=C("HELLO",2);const H=new THREE.BufferGeometry,F=new Float32Array(p.particleCount*3),Y=new Float32Array(p.particleCount*3),de=[],ue=[],fe=[],me=[],Z=[],K=[];function P(e,i){e.length=0;const s=2,o=.2;for(let n=0;n<p.particleCount;n++){if(i.length===0){e.push(new THREE.Vector3(0,0,0));continue}const r=Math.floor(Math.random()*i.length),a=i[r];e.push(new THREE.Vector3(a.x+(Math.random()-.5)*o,a.y+(Math.random()-.5)*o,a.z+(Math.random()-.5)*s))}}for(let e=0;e<p.particleCount;e++){const i=Math.random()*Math.PI*2,s=Math.acos(Math.random()*2-1),o=Math.cbrt(Math.random())*p.scatterRadius,n=o*Math.sin(s)*Math.cos(i),r=o*Math.sin(s)*Math.sin(i),a=o*Math.cos(s);F[e*3]=n,F[e*3+1]=r,F[e*3+2]=a,Y[e*3]=1,Y[e*3+1]=1,Y[e*3+2]=1,de.push(new THREE.Vector3(n,r,a))}P(ue,qe);P(fe,_e);P(me,je);P(Z,Ne);P(K,Ze);H.setAttribute("position",new THREE.BufferAttribute(F,3));H.setAttribute("color",new THREE.BufferAttribute(Y,3));const Ke=new THREE.PointsMaterial({vertexColors:!0,size:p.particleSize,transparent:!0,opacity:.9,blending:THREE.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),x=new THREE.Points(H,Ke);function Se(e){e.add(x)}function He(e){const i=Me*.8,o=document.createElement("canvas").getContext("2d");o.font="900 250px Arial, sans-serif";const r=o.measureText(e).width;let a=i/r;return a=Math.min(a,.08),a=Math.max(a,.02),a}function ae(e){const i=He(e);console.log(`Dynamic Text 5: "${e}", Scale: ${i}`);const s=C(e,2,i);P(K,s)}function Je(e){const i=He(e);console.log(`Update Text 4: "${e}", Scale: ${i}`);const s=C(e,2,i);P(Z,s)}const Qe=Object.freeze(Object.defineProperty({__proto__:null,initParticles:Se,particleGeometry:H,particleSystem:x,posScatter:de,posText1:ue,posText2:fe,posText3:me,posText4:Z,posText5:K,updateDynamicText:ae,updateText4:Je},Symbol.toStringTag,{value:"Module"})),ge=8e3,pe=new THREE.BufferGeometry,X=new Float32Array(ge*3),$=new Float32Array(ge*3);for(let e=0;e<ge;e++){const i=20+Math.random()*60,s=Math.random()*Math.PI*2,o=Math.acos(Math.random()*2-1);X[e*3]=i*Math.sin(o)*Math.cos(s),X[e*3+1]=i*Math.sin(o)*Math.sin(s),X[e*3+2]=i*Math.cos(o);const n=new THREE.Color,r=Math.random();r<.3?n.setHex(65535):r<.6?n.setHex(255):r<.8?n.setHex(4915330):n.setHex(16777215),n.multiplyScalar(.5+Math.random()*.5),$[e*3]=n.r,$[e*3+1]=n.g,$[e*3+2]=n.b}pe.setAttribute("position",new THREE.BufferAttribute(X,3));pe.setAttribute("color",new THREE.BufferAttribute($,3));const q=new THREE.PointsMaterial({vertexColors:!0,size:.04,transparent:!0,opacity:0,blending:THREE.AdditiveBlending,depthWrite:!1}),ce=new THREE.Points(pe,q);function et(e){e.add(ce)}const J=15e3,k=new THREE.BufferGeometry,_=new Float32Array(J*3),j=new Float32Array(J*3),Re=[];function tt(){let e,i,s;for(;;){e=(Math.random()-.5)*3,i=(Math.random()-.5)*3,s=(Math.random()-.5)*3;const o=e*e+9/4*i*i+s*s-1,n=e*e*s*s*s,r=9/80*i*i*s*s*s;if(o*o*o-n-r<0)return new THREE.Vector3(e,i,s)}}for(let e=0;e<J;e++){const i=tt(),s=16,o=i.x*s*1.2,n=i.z*s*1.2,r=i.y*s*.6;_[e*3]=o,_[e*3+1]=n,_[e*3+2]=r,Re.push(new THREE.Vector3(o,n,r));const a=new THREE.Color;a.setHSL(.92,1,.75),j[e*3]=a.r,j[e*3+1]=a.g,j[e*3+2]=a.b}k.setAttribute("position",new THREE.BufferAttribute(_,3));k.setAttribute("color",new THREE.BufferAttribute(j,3));const N=new THREE.PointsMaterial({vertexColors:!0,size:.15,transparent:!0,opacity:0,blending:THREE.AdditiveBlending,depthWrite:!1}),B=new THREE.Points(k,N);B.visible=!1;function nt(e){e.add(B)}const ot="modulepreload",it=function(e){return"/"+e},ve={},st=function(i,s,o){let n=Promise.resolve();if(s&&s.length>0){let a=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=a(s.map(c=>{if(c=it(c),c in ve)return;ve[c]=!0;const d=c.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":ot,d||(f.as="script"),f.crossOrigin="",f.href=c,m&&f.setAttribute("nonce",m),document.head.appendChild(f),d)return new Promise((T,M)=>{f.addEventListener("load",T),f.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return n.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return i().catch(r)})};function rt(e){const i=e[0],s=[8,12,16,20],o=[5,9,13,17];let n=0,r=0;for(let l=0;l<4;l++)n+=Math.hypot(e[s[l]].x-i.x,e[s[l]].y-i.y),r+=Math.hypot(e[o[l]].x-i.x,e[o[l]].y-i.y);const a=n/r;return Math.max(0,Math.min(1,(a-1)/1.2))}function at(e,i){let s=0;const o=[8,12,16,20],n=[6,10,14,18];for(let m=0;m<4;m++)e[o[m]].y<e[n[m]].y&&s++;const r=e[4],a=e[3];return i==="Right"?r.x<a.x&&s++:r.x>a.x&&s++,s}function Le(e){return e===1?p.text1:e===2?p.text2:e===3?p.text3:e===4?p.text4:""}function Ae(e){return e===1?[1,0,0,0,0]:e===2?[0,1,0,0,0]:e===3?[0,0,1,0,0]:e===4?[0,0,0,1,0]:t.targetWeights}function ct(e){if(!e.multiHandLandmarks||e.multiHandLandmarks.length!==2)return!1;const i=e.multiHandLandmarks[0],s=e.multiHandLandmarks[1],o=i[8],n=i[4],r=s[8],a=s[4],l=Math.hypot(o.x-r.x,o.y-r.y),m=Math.hypot(n.x-a.x,n.y-a.y),c=.08;return l<c&&m<c}function lt(e){const i=document.getElementById("loading");i&&(i.style.display="none");let s=0,o=0,n=1;if(t.handPositions=[],e.multiHandLandmarks&&e.multiHandLandmarks.length>0){t.isHandDetected=!0;for(const c of e.multiHandLandmarks){const d=1-c[9].x,g=c[9].y,f=new THREE.Vector3((d-.5)*Me,-(g-.5)*Te,0);t.handPositions.push(f)}const a=e.multiHandLandmarks[0],l=e.multiHandedness[0].label,m=a[0];if(t.handPositionRaw.x=1-m.x,t.handPositionRaw.y=m.y,o=at(a,l),n=rt(a),t.voiceEnabledByUser)t.targetWeights=[0,0,0,0,1],t.spreadTarget=0,t.galaxyEffectActive=!1;else{o===1?s=1:o===2?s=2:o===3?s=3:o===4&&(s=4);const c=ct(e),d=document.getElementById("card-layer");if(c?t.heartGestureStart===0?t.heartGestureStart=Date.now():Date.now()-t.heartGestureStart>2e3&&(t.isViewLocked=!0):t.heartGestureStart=0,t.isViewLocked&&o===0&&(t.isViewLocked=!1),t.isViewLocked)d&&d.classList.add("visible"),t.targetGestureLabel="LOCKED (Fist to Close)",t.spreadTarget=1,t.galaxyEffectActive=!1,t.scatterScaleTarget=1.5;else if(c){d&&d.classList.remove("visible");const g=Math.min((Date.now()-t.heartGestureStart)/2e3,1);t.targetGestureLabel=`Holding Heart... ${Math.floor(g*100)}%`,t.spreadTarget=1,t.galaxyEffectActive=!1,t.scatterScaleTarget=1.5}else if(s>0)d&&d.classList.remove("visible"),t.targetGestureLabel=Le(s),t.spreadTarget=0,t.targetWeights=Ae(s),t.galaxyEffectActive=s===4;else{d&&d.classList.remove("visible"),t.targetGestureLabel=o===0?"Fist (Contract)":"Scatter (Expand)",t.spreadTarget=1,t.galaxyEffectActive=!1;const g=.1,f=1.5;t.scatterScaleTarget=g+n*(f-g)}}t.fingerCount=o}else t.isHandDetected=!1,t.voiceEnabledByUser?(t.spreadTarget=0,t.targetWeights=[0,0,0,0,1],t.handPositionRaw.x=.5,t.handPositionRaw.y=.5):(t.spreadTarget=1,t.targetGestureLabel="Waiting...",t.scatterScaleTarget=1,t.handPositionRaw.x=.5,t.handPositionRaw.y=.5),t.fingerCount=0,t.galaxyEffectActive=!1;const r=document.getElementById("bg-music");r&&t.isHandDetected&&!t.musicActivated&&(t.musicActivated=!0,r.play().catch(a=>{console.log("Ph√°t nh·∫°c b·ªã ch·∫∑n:",a),t.musicActivated=!1})),he()}function dt(e){const i=document.getElementById("btn-collapse"),s=document.getElementById("ui-layer");i&&s&&i.addEventListener("click",()=>{s.classList.toggle("collapsed"),i.innerText=s.classList.contains("collapsed")?"+":"‚àí"});const o=document.getElementById("camera-wrapper"),n=document.getElementById("camera-handle");let r=!1,a={x:0,y:0};n&&o&&(n.addEventListener("mousedown",c=>{if(t.voiceModeActive)return;r=!0;const d=o.getBoundingClientRect();a.x=c.clientX-d.left,a.y=c.clientY-d.top,o.style.bottom="auto",o.style.right="auto",o.style.left=d.left+"px",o.style.top=d.top+"px"}),window.addEventListener("mousemove",c=>{r&&(o.style.left=c.clientX-a.x+"px",o.style.top=c.clientY-a.y+"px")}),window.addEventListener("mouseup",()=>{r=!1}));const l=document.getElementById("btn-update-text"),m=document.getElementById("custom-text-input");l&&m&&(l.addEventListener("click",()=>{const c=m.value.trim();c&&st(()=>Promise.resolve().then(()=>Qe),void 0).then(d=>{p.text4=c,d.updateText4(c),t.targetGestureLabel="Custom (G4): "+c,t.targetWeights=[0,0,0,0,1],t.targetWeights=[0,0,0,1,0],t.spreadTarget=0,t.galaxyEffectActive=!1,e&&e()})}),m.addEventListener("keypress",c=>{c.key==="Enter"&&l.click()}))}function he(){const e=document.getElementById("gesture-val"),i=document.getElementById("finger-val");e&&(e.innerText=t.targetGestureLabel),i&&(i.innerText=t.fingerCount)}let be=!1;const A={radius:240,rotateSpeed:-60,imgWidth:120,imgHeight:170};function ut(){be||(setTimeout(()=>{const e=document.getElementById("drag-container"),i=document.getElementById("spin-container");if(!e||!i)return;const s=i.querySelectorAll("img, video");i.style.width=A.imgWidth+"px",i.style.height=A.imgHeight+"px";const o=document.getElementById("ground");o&&(o.style.width=A.radius*3+"px",o.style.height=A.radius*3+"px");function n(h){for(let y=0;y<s.length;y++)s[y].style.transform="rotateY("+y*(360/s.length)+"deg) translateZ("+A.radius+"px)",s[y].style.transition="transform 1s",s[y].style.transitionDelay=h}n(1);{const h="spinRevert";i.style.animation=`${h} ${Math.abs(A.rotateSpeed)}s infinite linear`}let r,a,l,m,c=0,d=0,g=0,f=10;function T(h){f>180&&(f=180),f<0&&(f=0),h.style.transform="rotateX("+-f+"deg) rotateY("+g+"deg)"}function M(h){i.style.animationPlayState=h?"running":"paused"}document.onpointerdown=function(h){const y=document.getElementById("card-layer");if(!(!y||!y.classList.contains("visible")))return e.timer&&clearInterval(e.timer),h=h||window.event,r=h.clientX,a=h.clientY,this.onpointermove=function(u){u=u||window.event,l=u.clientX,m=u.clientY,c=l-r,d=m-a,g+=c*.1,f+=d*.1,T(e),r=l,a=m},this.onpointerup=function(u){e.timer=setInterval(function(){c*=.95,d*=.95,g+=c*.1,f+=d*.1,T(e),M(!1),Math.abs(c)<.5&&Math.abs(d)<.5&&(clearInterval(e.timer),M(!0))},17),this.onpointermove=this.onpointerup=null},!1},document.onmousewheel=function(h){const y=document.getElementById("card-layer");if(!y||!y.classList.contains("visible"))return;h=h||window.event;const u=h.wheelDelta/20||-h.detail;A.radius+=u,n(1)}},100),be=!0)}function ft(){const e=document.getElementById("btn-voice"),i=document.getElementById("voice-indicator"),s=document.getElementById("voice-btn-text");let o=null;if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const n=window.SpeechRecognition||window.webkitSpeechRecognition;o=new n,o.continuous=!0,o.interimResults=!1,o.lang="en-US",o.onstart=()=>{console.log("Voice recognition started"),i&&i.classList.add("listening"),s&&(s.innerText="Voice Mode: ON"),e&&e.classList.add("active")},o.onerror=r=>{console.error("Voice recognition error",r.error),r.error==="not-allowed"&&(alert("Microphone access denied. Please allow microphone access."),t.voiceEnabledByUser=!1),i&&i.classList.remove("listening")},o.onend=()=>{console.log("Voice recognition ended"),i&&i.classList.remove("listening"),t.voiceEnabledByUser?setTimeout(()=>{try{o.start()}catch(r){console.warn("Restart failed",r)}},300):(s&&(s.innerText="Enable Voice Mode"),e&&e.classList.remove("active"))},o.onresult=r=>{if(!t.voiceEnabledByUser)return;const a=r.results.length-1,c=r.results[a][0].transcript.trim().toUpperCase().split(" ").slice(-3).join(" ");c.length>0&&(ae(c),t.targetGestureLabel="Voice: "+c,t.targetWeights=[0,0,0,0,1],t.spreadTarget=0)}}else s&&(s.innerText="Voice Not Supported"),e&&(e.disabled=!0);e&&e.addEventListener("click",()=>{if(o)if(t.voiceEnabledByUser=!t.voiceEnabledByUser,t.voiceEnabledByUser)try{o.start(),t.voiceModeActive=!0,t.targetGestureLabel="Listening...",t.spreadTarget=0,t.targetWeights=[0,0,0,0,1],ae("HELLO")}catch(n){console.warn(n)}else o.stop(),t.voiceModeActive=!1,t.targetGestureLabel="Voice Mode OFF",t.spreadTarget=1})}Se(b);et(b);nt(b);dt(he);ft();ut();const re=document.getElementById("webcam-preview"),S=document.getElementById("loading"),ye=new Hands({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${e}`});ye.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5});ye.onResults(lt);let le=null;re&&(le=new Camera(re,{onFrame:async()=>{await ye.send({image:re})},width:1280,height:720}));async function mt(){try{if(S&&(S.innerHTML="Requesting Camera Access..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API 'navigator.mediaDevices.getUserMedia' not available");(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(i=>i.stop()),S&&(S.innerHTML="Starting MediaPipe Camera..."),le&&await le.start()}catch(e){console.error("Camera Error:",e),S&&(S.innerHTML=`Camera not found (${e.name}).<br>Switching to <b>Mouse Interaction Mode</b>.`),setTimeout(()=>{S&&(S.style.display="none"),gt()},2500)}}let Ce=!1;function gt(){Ce=!0,t.isHandDetected=!0;const e=document.getElementById("camera-wrapper");if(e&&(e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.background="rgba(20, 20, 20, 0.8)",e.style.border="1px solid #444",!document.getElementById("no-cam-msg"))){const n=document.createElement("div");n.id="no-cam-msg",n.innerHTML="NO CAMERA<br>Mouse Mode",n.style.color="#aaa",n.style.textAlign="center",n.style.fontSize="12px",n.style.position="absolute",e.appendChild(n)}const i=document.getElementById("webcam-preview");i&&(i.style.opacity="0.1"),window.addEventListener("mousemove",n=>{const r=new THREE.Vector3,a=new THREE.Vector3;r.set(n.clientX/window.innerWidth*2-1,-(n.clientY/window.innerHeight)*2+1,.5),r.unproject(E),r.sub(E.position).normalize();const l=-E.position.z/r.z;a.copy(E.position).add(r.multiplyScalar(l)),t.handPositions=[a],t.handPositionRaw.x=n.clientX/window.innerWidth,t.handPositionRaw.y=n.clientY/window.innerHeight});let s=0;window.addEventListener("click",()=>{if(t.voiceModeActive)return;s=(s+1)%5;const n=s;n===0?(t.targetGestureLabel="Mouse Click: Scatter",t.spreadTarget=1,t.galaxyEffectActive=!1):(t.targetGestureLabel="Mouse Click: "+Le(n),t.spreadTarget=0,t.targetWeights=Ae(n),t.galaxyEffectActive=n===4),he()});const o=document.getElementById("ui-content");if(o){const n=o.querySelector('div[style*="font-size: 11px"]');n&&(n.innerHTML=`
                    <b>Mouse Mode Active:</b><br>
                    üñ±Ô∏è Move mouse to interact<br>
                    üñ±Ô∏è Click to cycle gestures<br>
                    (I -> MISS -> YOU -> ...)<br>
                    <br>
                    <b>Voice Mode:</b><br>
                    üé§ Still works if Mic is available
                `)}}mt();function Pe(){requestAnimationFrame(Pe);const e=document.getElementById("camera-wrapper");t.voiceModeActive!==t.wasVoiceModeActive&&(t.voiceModeActive?(e&&(e.classList.add("fullscreen"),e.style.top="",e.style.left="",e.style.bottom="",e.style.right=""),Ce?b.background=new THREE.Color(328965):b.background=null):(e&&(e.classList.remove("fullscreen"),e.style.top||(e.style.bottom="15px",e.style.right="15px")),b.background=new THREE.Color(328965)),t.wasVoiceModeActive=t.voiceModeActive),t.currentSpread+=(t.spreadTarget-t.currentSpread)*.08,t.currentScatterScale+=(t.scatterScaleTarget-t.currentScatterScale)*.1;for(let u=0;u<5;u++)t.currentWeights[u]+=(t.targetWeights[u]-t.currentWeights[u])*.1;const i=(t.handPositionRaw.x-.5)*1.5,s=(t.handPositionRaw.y-.5)*1.5;x.rotation.y+=(i-x.rotation.y)*.1,x.rotation.x+=(s-x.rotation.x)*.1,ce.rotation.y+=.002,ce.rotation.x+=.001;const o=H.attributes.position.array,n=H.attributes.color.array,r=Date.now()*.001,a=t.currentWeights[0],l=t.currentWeights[1],m=t.currentWeights[2],c=t.currentWeights[3],d=t.currentWeights[4],g=p.interactionRadius*p.interactionRadius;for(let u=0;u<p.particleCount;u++){const R=ue[u],w=fe[u],L=me[u],Q=Z[u],ee=K[u],Be=R.x*a+w.x*l+L.x*m+Q.x*c+ee.x*d,Ie=R.y*a+w.y*l+L.y*m+Q.y*c+ee.y*d,We=R.z*a+w.z*l+L.z*m+Q.z*c+ee.z*d,te=de[u],Ge=te.x*t.currentScatterScale,ze=te.y*t.currentScatterScale,Ue=te.z*t.currentScatterScale,Ee=.5*t.currentScatterScale,Ve=Math.sin(r+u*.1)*Ee,ke=Math.cos(r+u*.13)*Ee;let W=THREE.MathUtils.lerp(Be,Ge+Ve,t.currentSpread),G=THREE.MathUtils.lerp(Ie,ze+ke,t.currentSpread),z=THREE.MathUtils.lerp(We,Ue,t.currentSpread);if(t.voiceModeActive&&t.handPositions.length>0)for(const U of t.handPositions){const V=W-U.x,oe=G-U.y,ie=z-U.z,we=V*V+oe*oe+ie*ie;if(we<g){const O=Math.sqrt(we),Xe=(p.interactionRadius-O)/p.interactionRadius,se=Math.pow(Xe,2)*p.repulsionStrength;W+=V/O*se*5,G+=oe/O*se*5,z+=ie/O*se*5}}const De=o[u*3],Oe=o[u*3+1],Fe=o[u*3+2],ne=.1;o[u*3]+=(W-De)*ne,o[u*3+1]+=(G-Oe)*ne,o[u*3+2]+=(z-Fe)*ne;const v=new THREE.Color,Ye=new THREE.Color(65535);if(t.currentSpread>.8){const U=Math.sqrt(W*W+G*G+z*z),V=Math.min(U/40,1);v.setHSL(.9,.5,.8+V*.2)}else d>.5?(v.copy(Ye),v.offsetHSL(0,0,.1),Math.random()>.92&&v.setHex(16777215)):(a>.5||l>.5||m>.5||c>.5,v.setHSL(.92,1,.75));n[u*3]=v.r,n[u*3+1]=v.g,n[u*3+2]=v.b}H.attributes.position.needsUpdate=!0,H.attributes.color.needsUpdate=!0,q.opacity=THREE.MathUtils.lerp(q.opacity,t.galaxyEffectActive?.8:0,.03);const f=t.isHandDetected&&t.fingerCount===0&&!t.voiceModeActive,T=f?0:1,M=x.scale.x,h=THREE.MathUtils.lerp(M,T,.08);x.scale.setScalar(h);let y=0;if(f?h<.2&&(y=.9):y=0,N.opacity=THREE.MathUtils.lerp(N.opacity,y,.1),B.visible=N.opacity>.01,B.visible){const u=1+.15*Math.sin(r*6);B.rotation.y=x.rotation.y,B.rotation.x=x.rotation.x;const R=k.attributes.position.array;for(let w=0;w<J;w++){const L=Re[w];R[w*3]=L.x*u,R[w*3+1]=L.y*u,R[w*3+2]=L.z*u}k.attributes.position.needsUpdate=!0}f&&(q.opacity*=.9),D.update(),I.render(b,E)}Pe();
