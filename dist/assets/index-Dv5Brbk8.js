(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();const e={targetGestureLabel:"Waiting...",currentWeights:[0,0,0,0,0],targetWeights:[0,0,0,0,0],spreadTarget:1,currentSpread:1,scatterScaleTarget:1,currentScatterScale:1,fingerCount:0,galaxyEffectActive:!1,voiceModeActive:!1,wasVoiceModeActive:!1,voiceEnabledByUser:!1,handPositionRaw:{x:.5,y:.5},handPositions:[],isHandDetected:!1,musicActivated:!1,blackHoleStart:0,blackHoleActive:!1,bigBangActive:!1,bigBangStart:0,heartPersistent:!1,heartGestureStart:0,isViewLocked:!1},m={particleCount:4e4,text1:"Hey",text2:"I wanna tell u",text3:"I miss u",text4:"And u ?",particleSize:.08,scatterRadius:35,textScale:.055,camZ:40,interactionRadius:8,repulsionStrength:8},Te=document.getElementById("canvas-container"),D=new THREE.Scene;D.background=new THREE.Color(328965);D.fog=new THREE.FogExp2(328965,.012);const P=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);P.position.z=m.camZ;const ct=THREE.MathUtils.degToRad(P.fov),Le=2*Math.tan(ct/2)*P.position.z,lt=Le*P.aspect,X=new THREE.WebGLRenderer({antialias:!0,alpha:!0});X.setSize(window.innerWidth,window.innerHeight);X.setPixelRatio(window.devicePixelRatio);Te&&Te.appendChild(X.domElement);const Z=new THREE.OrbitControls(P,X.domElement);Z.enableDamping=!0;Z.dampingFactor=.05;Z.autoRotate=!1;Z.enableZoom=!1;window.addEventListener("resize",()=>{P.aspect=window.innerWidth/window.innerHeight,P.updateProjectionMatrix(),X.setSize(window.innerWidth,window.innerHeight)});function O(t,s=2,a=null){console.log(`Generating text coords for: "${t}"`);const o=document.createElement("canvas"),n=o.getContext("2d"),i=3e3,r=800;o.width=i,o.height=r,n.fillStyle="black",n.fillRect(0,0,i,r),n.fillStyle="white",n.font="900 250px Arial, sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillText(t,i/2,r/2);const f=n.getImageData(0,0,i,r).data,d=[],u=a||m.textScale;for(let y=0;y<r;y+=s)for(let p=0;p<i;p+=s){const G=(y*i+p)*4;if(f[G]>128){const z=(p-i/2)*u,g=-(y-r/2)*u;d.push(new THREE.Vector3(z,g,0))}}return console.log(`Generated ${d.length} points for "${t}"`),d}const dt=O(m.text1,3),ft=O(m.text2,3),ut=O(m.text3,3),gt=O(m.text4,3);let pt=O("HELLO",2);const V=new THREE.BufferGeometry,K=new Float32Array(m.particleCount*3),J=new Float32Array(m.particleCount*3),Be=[],Pe=[],Ce=[],Ie=[],ke=[],me=[];function q(t,s){t.length=0;const a=2,o=.2;for(let n=0;n<m.particleCount;n++){if(s.length===0){t.push(new THREE.Vector3(0,0,0));continue}const i=Math.floor(Math.random()*s.length),r=s[i];t.push(new THREE.Vector3(r.x+(Math.random()-.5)*o,r.y+(Math.random()-.5)*o,r.z+(Math.random()-.5)*a))}}for(let t=0;t<m.particleCount;t++){const s=Math.random()*Math.PI*2,a=Math.acos(Math.random()*2-1),o=Math.cbrt(Math.random())*m.scatterRadius,n=o*Math.sin(a)*Math.cos(s),i=o*Math.sin(a)*Math.sin(s),r=o*Math.cos(a);K[t*3]=n,K[t*3+1]=i,K[t*3+2]=r,J[t*3]=1,J[t*3+1]=1,J[t*3+2]=1,Be.push(new THREE.Vector3(n,i,r))}q(Pe,dt);q(Ce,ft);q(Ie,ut);q(ke,gt);q(me,pt);V.setAttribute("position",new THREE.BufferAttribute(K,3));V.setAttribute("color",new THREE.BufferAttribute(J,3));const ht=new THREE.PointsMaterial({vertexColors:!0,size:m.particleSize,transparent:!0,opacity:.9,blending:THREE.AdditiveBlending,depthWrite:!1,sizeAttenuation:!0}),B=new THREE.Points(V,ht);function mt(t){t.add(B)}function Re(t){const s=Math.max(t.length,3);let a=.09;s>4&&(a=.4/s),a=Math.max(.035,a);const o=O(t,2,a);q(me,o)}const ye=8e3,be=new THREE.BufferGeometry,Q=new Float32Array(ye*3),_=new Float32Array(ye*3);for(let t=0;t<ye;t++){const s=20+Math.random()*60,a=Math.random()*Math.PI*2,o=Math.acos(Math.random()*2-1);Q[t*3]=s*Math.sin(o)*Math.cos(a),Q[t*3+1]=s*Math.sin(o)*Math.sin(a),Q[t*3+2]=s*Math.cos(o);const n=new THREE.Color,i=Math.random();i<.3?n.setHex(65535):i<.6?n.setHex(255):i<.8?n.setHex(4915330):n.setHex(16777215),n.multiplyScalar(.5+Math.random()*.5),_[t*3]=n.r,_[t*3+1]=n.g,_[t*3+2]=n.b}be.setAttribute("position",new THREE.BufferAttribute(Q,3));be.setAttribute("color",new THREE.BufferAttribute(_,3));const ee=new THREE.PointsMaterial({vertexColors:!0,size:.04,transparent:!0,opacity:0,blending:THREE.AdditiveBlending,depthWrite:!1}),pe=new THREE.Points(be,ee);function yt(t){t.add(pe)}const ie=15e3,N=new THREE.BufferGeometry,te=new Float32Array(ie*3),ne=new Float32Array(ie*3),Ge=[];function bt(){let t,s,a;for(;;){t=(Math.random()-.5)*3,s=(Math.random()-.5)*3,a=(Math.random()-.5)*3;const o=t*t+9/4*s*s+a*a-1,n=t*t*a*a*a,i=9/80*s*s*a*a*a;if(o*o*o-n-i<0)return new THREE.Vector3(t,s,a)}}for(let t=0;t<ie;t++){const s=bt(),a=16,o=s.x*a*1.2,n=s.z*a*1.2,i=s.y*a*.6;te[t*3]=o,te[t*3+1]=n,te[t*3+2]=i,Ge.push(new THREE.Vector3(o,n,i));const r=new THREE.Color;r.setHSL(.92,1,.75),ne[t*3]=r.r,ne[t*3+1]=r.g,ne[t*3+2]=r.b}N.setAttribute("position",new THREE.BufferAttribute(te,3));N.setAttribute("color",new THREE.BufferAttribute(ne,3));const oe=new THREE.PointsMaterial({vertexColors:!0,size:.15,transparent:!0,opacity:0,blending:THREE.AdditiveBlending,depthWrite:!1}),Y=new THREE.Points(N,oe);Y.visible=!1;function wt(t){t.add(Y)}function Et(t){const s=t[0],a=[8,12,16,20],o=[5,9,13,17];let n=0,i=0;for(let l=0;l<4;l++)n+=Math.hypot(t[a[l]].x-s.x,t[a[l]].y-s.y),i+=Math.hypot(t[o[l]].x-s.x,t[o[l]].y-s.y);const r=n/i;return Math.max(0,Math.min(1,(r-1)/1.2))}function vt(t,s){let a=0;const o=[8,12,16,20],n=[6,10,14,18];for(let f=0;f<4;f++)t[o[f]].y<t[n[f]].y&&a++;const i=t[4],r=t[3];return s==="Right"?i.x<r.x&&a++:i.x>r.x&&a++,a}function De(t){return t===1?m.text1:t===2?m.text2:t===3?m.text3:t===4?m.text4:""}function ze(t){return t===1?[1,0,0,0,0]:t===2?[0,1,0,0,0]:t===3?[0,0,1,0,0]:t===4?[0,0,0,1,0]:e.targetWeights}function xt(t){if(!t.multiHandLandmarks||t.multiHandLandmarks.length!==2)return!1;const s=t.multiHandLandmarks[0],a=t.multiHandLandmarks[1],o=s[8],n=s[4],i=a[8],r=a[4],l=Math.hypot(o.x-i.x,o.y-i.y),f=Math.hypot(n.x-r.x,n.y-r.y),d=.08;return l<d&&f<d}function Mt(t){const s=document.getElementById("loading");s&&(s.style.display="none");let a=0,o=0,n=1;if(e.handPositions=[],t.multiHandLandmarks&&t.multiHandLandmarks.length>0){e.isHandDetected=!0;for(const d of t.multiHandLandmarks){const u=1-d[9].x,y=d[9].y,p=new THREE.Vector3((u-.5)*lt,-(y-.5)*Le,0);e.handPositions.push(p)}const r=t.multiHandLandmarks[0],l=t.multiHandedness[0].label,f=r[0];if(e.handPositionRaw.x=1-f.x,e.handPositionRaw.y=f.y,o=vt(r,l),n=Et(r),e.voiceEnabledByUser)e.targetWeights=[0,0,0,0,1],e.spreadTarget=0,e.galaxyEffectActive=!1;else{o===1?a=1:o===2?a=2:o===3?a=3:o===4&&(a=4);const d=xt(t),u=document.getElementById("card-layer");if(d?e.heartGestureStart===0?e.heartGestureStart=Date.now():Date.now()-e.heartGestureStart>2e3&&(e.isViewLocked=!0):e.heartGestureStart=0,e.isViewLocked&&o===0&&(e.isViewLocked=!1),e.isViewLocked)u&&u.classList.add("visible"),e.targetGestureLabel="LOCKED (Fist to Close)",e.spreadTarget=1,e.galaxyEffectActive=!1,e.scatterScaleTarget=1.5;else if(d){u&&u.classList.remove("visible");const y=Math.min((Date.now()-e.heartGestureStart)/2e3,1);e.targetGestureLabel=`Holding Heart... ${Math.floor(y*100)}%`,e.spreadTarget=1,e.galaxyEffectActive=!1,e.scatterScaleTarget=1.5}else if(a>0)u&&u.classList.remove("visible"),e.targetGestureLabel=De(a),e.spreadTarget=0,e.targetWeights=ze(a),e.galaxyEffectActive=a===4;else if(u&&u.classList.remove("visible"),o===0){if(e.blackHoleStart===0)e.blackHoleStart=Date.now(),e.blackHoleActive=!0,e.bigBangActive=!1,e.heartPersistent=!1;else if(Date.now()-e.blackHoleStart>=3e3&&!e.bigBangActive){e.bigBangActive=!0,e.bigBangStart=Date.now(),e.blackHoleActive=!1;const z=new Audio("/mp3/explosion-fx-343683.mp3");z.volume=.8,z.play().catch(g=>console.log("Sound play blocked:",g))}if(e.bigBangActive)Date.now()-e.bigBangStart<1e3?e.targetGestureLabel="‚ö° BIG BANG! ‚ö°":(e.targetGestureLabel="Heart Forming...",e.heartPersistent=!0);else{const G=Math.min((Date.now()-e.blackHoleStart)/3e3,1);e.targetGestureLabel=`Black Hole... ${Math.floor(G*100)}%`}e.spreadTarget=1,e.galaxyEffectActive=!1;const y=.1,p=1.5;e.scatterScaleTarget=y+n*(p-y)}else{e.heartPersistent?(e.heartPersistent=!1,e.blackHoleStart=0,e.blackHoleActive=!1,e.bigBangActive=!1):(e.blackHoleStart=0,e.blackHoleActive=!1,e.bigBangActive=!1),e.targetGestureLabel="Scatter (Expand)",e.spreadTarget=1,e.galaxyEffectActive=!1;const y=.1,p=1.5;e.scatterScaleTarget=y+n*(p-y)}}e.fingerCount=o}else e.isHandDetected=!1,e.voiceEnabledByUser?(e.spreadTarget=0,e.targetWeights=[0,0,0,0,1],e.handPositionRaw.x=.5,e.handPositionRaw.y=.5):(e.spreadTarget=1,e.targetGestureLabel="Waiting...",e.scatterScaleTarget=1,e.handPositionRaw.x=.5,e.handPositionRaw.y=.5),e.fingerCount=0,e.galaxyEffectActive=!1;const i=document.getElementById("bg-music");i&&e.isHandDetected&&!e.musicActivated&&(e.musicActivated=!0,i.play().catch(r=>{console.log("Ph√°t nh·∫°c b·ªã ch·∫∑n:",r),e.musicActivated=!1})),We()}function Ht(t){const s=document.getElementById("btn-collapse"),a=document.getElementById("ui-layer");s&&a&&s.addEventListener("click",()=>{a.classList.toggle("collapsed"),s.innerText=a.classList.contains("collapsed")?"+":"‚àí"});const o=document.getElementById("camera-wrapper"),n=document.getElementById("camera-handle");let i=!1,r={x:0,y:0};n&&o&&(n.addEventListener("mousedown",l=>{if(e.voiceModeActive)return;i=!0;const f=o.getBoundingClientRect();r.x=l.clientX-f.left,r.y=l.clientY-f.top,o.style.bottom="auto",o.style.right="auto",o.style.left=f.left+"px",o.style.top=f.top+"px"}),window.addEventListener("mousemove",l=>{i&&(o.style.left=l.clientX-r.x+"px",o.style.top=l.clientY-r.y+"px")}),window.addEventListener("mouseup",()=>{i=!1}))}function We(){const t=document.getElementById("gesture-val"),s=document.getElementById("finger-val");t&&(t.innerText=e.targetGestureLabel),s&&(s.innerText=e.fingerCount)}let Ae=!1;const U={radius:240,rotateSpeed:-60,imgWidth:120,imgHeight:170};function St(){Ae||(setTimeout(()=>{const t=document.getElementById("drag-container"),s=document.getElementById("spin-container");if(!t||!s)return;const a=s.querySelectorAll("img, video");s.style.width=U.imgWidth+"px",s.style.height=U.imgHeight+"px";const o=document.getElementById("ground");o&&(o.style.width=U.radius*3+"px",o.style.height=U.radius*3+"px");function n(g){for(let w=0;w<a.length;w++)a[w].style.transform="rotateY("+w*(360/a.length)+"deg) translateZ("+U.radius+"px)",a[w].style.transition="transform 1s",a[w].style.transitionDelay=g}n(1);{const g="spinRevert";s.style.animation=`${g} ${Math.abs(U.rotateSpeed)}s infinite linear`}let i,r,l,f,d=0,u=0,y=0,p=10;function G(g){p>180&&(p=180),p<0&&(p=0),g.style.transform="rotateX("+-p+"deg) rotateY("+y+"deg)"}function z(g){s.style.animationPlayState=g?"running":"paused"}document.onpointerdown=function(g){const w=document.getElementById("card-layer");if(!(!w||!w.classList.contains("visible")))return t.timer&&clearInterval(t.timer),g=g||window.event,i=g.clientX,r=g.clientY,this.onpointermove=function(c){c=c||window.event,l=c.clientX,f=c.clientY,d=l-i,u=f-r,y+=d*.1,p+=u*.1,G(t),i=l,r=f},this.onpointerup=function(c){t.timer=setInterval(function(){d*=.95,u*=.95,y+=d*.1,p+=u*.1,G(t),z(!1),Math.abs(d)<.5&&Math.abs(u)<.5&&(clearInterval(t.timer),z(!0))},17),this.onpointermove=this.onpointerup=null},!1},document.onmousewheel=function(g){const w=document.getElementById("card-layer");if(!w||!w.classList.contains("visible"))return;g=g||window.event;const c=g.wheelDelta/20||-g.detail;U.radius+=c,n(1)}},100),Ae=!0)}function Tt(){const t=document.getElementById("btn-voice"),s=document.getElementById("voice-indicator"),a=document.getElementById("voice-btn-text");let o=null;if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const n=window.SpeechRecognition||window.webkitSpeechRecognition;o=new n,o.continuous=!0,o.interimResults=!1,o.lang="en-US",o.onstart=()=>{console.log("Voice recognition started"),s&&s.classList.add("listening"),a&&(a.innerText="Voice Mode: ON"),t&&t.classList.add("active")},o.onerror=i=>{console.error("Voice recognition error",i.error),i.error==="not-allowed"&&(alert("Microphone access denied. Please allow microphone access."),e.voiceEnabledByUser=!1),s&&s.classList.remove("listening")},o.onend=()=>{console.log("Voice recognition ended"),s&&s.classList.remove("listening"),e.voiceEnabledByUser?setTimeout(()=>{try{o.start()}catch(i){console.warn("Restart failed",i)}},300):(a&&(a.innerText="Enable Voice Mode"),t&&t.classList.remove("active"))},o.onresult=i=>{if(!e.voiceEnabledByUser)return;const r=i.results.length-1,d=i.results[r][0].transcript.trim().toUpperCase().split(" ").slice(-3).join(" ");d.length>0&&(Re(d),e.targetGestureLabel="Voice: "+d,e.targetWeights=[0,0,0,0,1],e.spreadTarget=0)}}else a&&(a.innerText="Voice Not Supported"),t&&(t.disabled=!0);t&&t.addEventListener("click",()=>{if(o)if(e.voiceEnabledByUser=!e.voiceEnabledByUser,e.voiceEnabledByUser)try{o.start(),e.voiceModeActive=!0,e.targetGestureLabel="Listening...",e.spreadTarget=0,e.targetWeights=[0,0,0,0,1],Re("HELLO")}catch(n){console.warn(n)}else o.stop(),e.voiceModeActive=!1,e.targetGestureLabel="Voice Mode OFF",e.spreadTarget=1})}mt(D);yt(D);wt(D);Ht();Tt();St();const Rt=new THREE.RingGeometry(.5,1,64),At=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,transparent:!0,opacity:.6}),T=new THREE.Mesh(Rt,At);T.position.set(0,0,0);T.rotation.x=Math.PI/2;T.visible=!1;D.add(T);const ge=document.getElementById("webcam-preview"),W=document.getElementById("loading"),we=new Hands({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${t}`});we.setOptions({maxNumHands:2,modelComplexity:1,minDetectionConfidence:.5,minTrackingConfidence:.5});we.onResults(Mt);let he=null;ge&&(he=new Camera(ge,{onFrame:async()=>{await we.send({image:ge})},width:1280,height:720}));async function Lt(){try{if(W&&(W.innerHTML="Requesting Camera Access..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Browser API 'navigator.mediaDevices.getUserMedia' not available");(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(s=>s.stop()),W&&(W.innerHTML="Starting MediaPipe Camera..."),he&&await he.start()}catch(t){console.error("Camera Error:",t),W&&(W.innerHTML=`Camera not found (${t.name}).<br>Switching to <b>Mouse Interaction Mode</b>.`),setTimeout(()=>{W&&(W.style.display="none"),Bt()},2500)}}let Fe=!1;function Bt(){Fe=!0,e.isHandDetected=!0;const t=document.getElementById("camera-wrapper");if(t&&(t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.background="rgba(20, 20, 20, 0.8)",t.style.border="1px solid #444",!document.getElementById("no-cam-msg"))){const n=document.createElement("div");n.id="no-cam-msg",n.innerHTML="NO CAMERA<br>Mouse Mode",n.style.color="#aaa",n.style.textAlign="center",n.style.fontSize="12px",n.style.position="absolute",t.appendChild(n)}const s=document.getElementById("webcam-preview");s&&(s.style.opacity="0.1"),window.addEventListener("mousemove",n=>{const i=new THREE.Vector3,r=new THREE.Vector3;i.set(n.clientX/window.innerWidth*2-1,-(n.clientY/window.innerHeight)*2+1,.5),i.unproject(P),i.sub(P.position).normalize();const l=-P.position.z/i.z;r.copy(P.position).add(i.multiplyScalar(l)),e.handPositions=[r],e.handPositionRaw.x=n.clientX/window.innerWidth,e.handPositionRaw.y=n.clientY/window.innerHeight});let a=0;window.addEventListener("click",()=>{if(e.voiceModeActive)return;a=(a+1)%5;const n=a;n===0?(e.targetGestureLabel="Mouse Click: Scatter",e.spreadTarget=1,e.galaxyEffectActive=!1):(e.targetGestureLabel="Mouse Click: "+De(n),e.spreadTarget=0,e.targetWeights=ze(n),e.galaxyEffectActive=n===4),We()});const o=document.getElementById("ui-content");if(o){const n=o.querySelector('div[style*="font-size: 11px"]');n&&(n.innerHTML=`
                    <b>Mouse Mode Active:</b><br>
                    üñ±Ô∏è Move mouse to interact<br>
                    üñ±Ô∏è Click to cycle gestures<br>
                    (I -> MISS -> YOU -> ...)<br>
                    <br>
                    <b>Voice Mode:</b><br>
                    üé§ Still works if Mic is available
                `)}}Lt();function Ue(){requestAnimationFrame(Ue);const t=document.getElementById("camera-wrapper");e.voiceModeActive!==e.wasVoiceModeActive&&(e.voiceModeActive?(t&&(t.classList.add("fullscreen"),t.style.top="",t.style.left="",t.style.bottom="",t.style.right=""),Fe?D.background=new THREE.Color(328965):D.background=null):(t&&(t.classList.remove("fullscreen"),t.style.top||(t.style.bottom="15px",t.style.right="15px")),D.background=new THREE.Color(328965)),e.wasVoiceModeActive=e.voiceModeActive),e.currentSpread+=(e.spreadTarget-e.currentSpread)*.08,e.currentScatterScale+=(e.scatterScaleTarget-e.currentScatterScale)*.1;for(let c=0;c<5;c++)e.currentWeights[c]+=(e.targetWeights[c]-e.currentWeights[c])*.1;const s=(e.handPositionRaw.x-.5)*1.5,a=(e.handPositionRaw.y-.5)*1.5;B.rotation.y+=(s-B.rotation.y)*.1,B.rotation.x+=(a-B.rotation.x)*.1,pe.rotation.y+=.002,pe.rotation.x+=.001;const o=V.attributes.position.array,n=V.attributes.color.array,i=Date.now()*.001,r=e.currentWeights[0],l=e.currentWeights[1],f=e.currentWeights[2],d=e.currentWeights[3],u=e.currentWeights[4],y=m.interactionRadius*m.interactionRadius;for(let c=0;c<m.particleCount;c++){const M=Pe[c],E=Ce[c],F=Ie[c],ae=ke[c],se=me[c],Ve=M.x*r+E.x*l+F.x*f+ae.x*d+se.x*u,Ye=M.y*r+E.y*l+F.y*f+ae.y*d+se.y*u,Xe=M.z*r+E.z*l+F.z*f+ae.z*d+se.z*u,re=Be[c],Oe=re.x*e.currentScatterScale,qe=re.y*e.currentScatterScale,Ne=re.z*e.currentScatterScale,Ee=.5*e.currentScatterScale,Ze=Math.sin(i+c*.1)*Ee,$e=Math.cos(i+c*.13)*Ee;let H=THREE.MathUtils.lerp(Ve,Oe+Ze,e.currentSpread),S=THREE.MathUtils.lerp(Ye,qe+$e,e.currentSpread),R=THREE.MathUtils.lerp(Xe,Ne,e.currentSpread);if(e.voiceModeActive&&e.handPositions.length>0)for(const C of e.handPositions){const b=H-C.x,A=S-C.y,h=R-C.z,I=b*b+A*A+h*h;if(I<y){const L=Math.sqrt(I),k=(m.interactionRadius-L)/m.interactionRadius,v=Math.pow(k,2)*m.repulsionStrength;H+=b/L*v*5,S+=A/L*v*5,R+=h/L*v*5}}if(e.blackHoleActive){const h=0-H,I=0-S,L=0-R,k=h*h+I*I+L*L,v=Math.sqrt(k)+.001,$=Date.now()-e.blackHoleStart,le=Math.min($/3e3,1),ve=100*Math.pow(5,le),de=ve/(v*v+.1),xe=3;let j=1;v<xe&&(j=1+(xe-v)*2);const _e=h/v*de*j,et=I/v*de*j,tt=L/v*de*j,fe=-I,ue=h,Me=Math.sqrt(fe*fe+ue*ue)+.01,nt=fe/Me,ot=ue/Me,He=Math.sqrt(ve/v)*(1.2+le*.8),it=nt*He,at=ot*He;H+=_e+it,S+=et+at,R+=tt,R*=.95;const Se=.5*le,st=Math.sin(i*3+c*.1)*Se,rt=Math.cos(i*2.5+c*.15)*Se;H+=st*Math.cos(c*.5),S+=rt*Math.sin(c*.5)}if(e.bigBangActive){const C=Date.now()-e.bigBangStart;if(C<2e3){const b=C/2e3,A=H,h=S,I=R,L=Math.sqrt(A*A+h*h+I*I)+.1;let k;b<.3?k=100*(1-b/.3):b<.7?k=40*Math.sin((b-.3)*Math.PI/.4):k=20*(1-(b-.7)/.3);const v=1+(Math.random()-.5)*.3;H+=A/L*k*v,S+=h/L*k*v,R+=I/L*k*v;const $=k*.05;H+=Math.sin(i*3+c)*$,S+=Math.cos(i*3+c)*$}}const je=o[c*3],Ke=o[c*3+1],Je=o[c*3+2],ce=.1;o[c*3]+=(H-je)*ce,o[c*3+1]+=(S-Ke)*ce,o[c*3+2]+=(R-Je)*ce;const x=new THREE.Color,Qe=new THREE.Color(65535);if(e.blackHoleActive||e.bigBangActive){const C=Math.sqrt(H*H+S*S+R*R),b=Math.min(C/30,1);if(e.blackHoleActive){if(b<.15){const h=1-b/.15;x.setRGB(.8+h*.2,.9+h*.1,1)}else if(b<.4){const h=(b-.15)/.25;x.setHSL(.55,.8,.7+(1-h)*.3)}else{const h=(b-.4)/.6;x.setHSL(.05+h*.05,1,.5+(1-h)*.2)}const A=Math.sin(i*5+c*.5)*.1;x.offsetHSL(0,0,A)}else if(e.bigBangActive){const A=Date.now()-e.bigBangStart,h=Math.min(A/1e3,1);x.setHSL(.15,1,.9-h*.4)}}else if(e.currentSpread>.8){const C=Math.sqrt(H*H+S*S+R*R),b=Math.min(C/40,1);x.setHSL(.9,.5,.8+b*.2)}else u>.5?(x.copy(Qe),x.offsetHSL(0,0,.1),Math.random()>.92&&x.setHex(16777215)):(r>.5||l>.5||f>.5||d>.5,x.setHSL(.92,1,.75));n[c*3]=x.r,n[c*3+1]=x.g,n[c*3+2]=x.b}if(V.attributes.position.needsUpdate=!0,V.attributes.color.needsUpdate=!0,T)if(e.blackHoleActive){const c=Date.now()-e.blackHoleStart,M=Math.min(c/3e3,1);T.visible=!0;const E=1-M;T.scale.set(E,E,1),T.material.opacity=.6*(1-M)}else if(e.bigBangActive){const c=Date.now()-e.bigBangStart;if(c<1e3){const M=c/1e3;T.visible=!0;const E=M*3;T.scale.set(E,E,1),T.material.opacity=.6*(1-M)}else T.visible=!1}else T.visible=!1;e.bigBangActive&&Date.now()-e.bigBangStart>=1e3?B.visible=!1:B.visible=!0,ee.opacity=THREE.MathUtils.lerp(ee.opacity,e.galaxyEffectActive?.8:0,.03);const p=e.isHandDetected&&e.fingerCount===0&&!e.voiceModeActive&&!e.blackHoleActive&&!e.bigBangActive||e.heartPersistent,G=p?0:1,z=B.scale.x,g=THREE.MathUtils.lerp(z,G,.08);B.scale.setScalar(g);let w=0;if(p?g<.2&&(w=.9):w=0,oe.opacity=THREE.MathUtils.lerp(oe.opacity,w,.1),Y.visible=oe.opacity>.01,Y.visible){const c=1+.15*Math.sin(i*6);Y.rotation.y=B.rotation.y,Y.rotation.x=B.rotation.x;const M=N.attributes.position.array;for(let E=0;E<ie;E++){const F=Ge[E];M[E*3]=F.x*c,M[E*3+1]=F.y*c,M[E*3+2]=F.z*c}N.attributes.position.needsUpdate=!0}p&&(ee.opacity*=.9),Z.update(),X.render(D,P)}Ue();
